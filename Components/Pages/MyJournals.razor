@page "/my-journals"
@using JournalApp.Models
@inject JournalApp.Services.JournalService JournalService
@inject NavigationManager Nav

<h3>My Journal Entries</h3>

@if (entries is null)
{
    <p>Loading...</p>
}
else if (entries.Count == 0)
{
    <p>No journal entries saved yet.</p>
}
else
{
    <table class="table" style="max-width:900px">
        <thead>
            <tr>
                <th>Date</th>
                <th>Title</th>
                <th>Primary Mood</th>
                <th>Tags</th>
                <th style="width:160px">Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var e in entries)
            {
                <tr>
                    <td>@e.EntryDate.ToString("yyyy-MM-dd")</td>
                    <td>@e.Title</td>
                    <td>@e.PrimaryMood</td>
                    <td>@e.Tags</td>
                    <td>
                        <button class="btn btn-primary btn-sm" @onclick="() => EditEntry(e.EntryDate)">
                            Edit
                        </button>

                        <button class="btn btn-danger btn-sm" style="margin-left:8px"
                                @onclick="() => DeleteEntry(e.EntryDate)">
                            Del
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private List<JournalEntry>? entries;

    protected override async Task OnInitializedAsync()
    {
        await LoadEntries();
    }

    private async Task LoadEntries()
    {
        entries = await JournalService.GetAllAsync();
    }

    private void EditEntry(DateOnly date)
    {
        // go open editor for that exact day
        Nav.NavigateTo($"/editor/{date:yyyy-MM-dd}");
    }

    private async Task DeleteEntry(DateOnly date)
    {
        await JournalService.DeleteAsync(date);
        await LoadEntries();
    }
}
