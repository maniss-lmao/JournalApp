@inject NavigationManager Nav
@inject JournalApp.Services.AppState AppState
@inject JournalApp.Services.LockService LockService

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var path = new Uri(Nav.Uri).AbsolutePath.ToLowerInvariant(); // Current route check

        bool allowed =
            path.StartsWith("/setup") ||
            path.StartsWith("/unlock") ||
            path.StartsWith("/reset-verify"); // Public routes without lock

        if (allowed) return;

        if (!await LockService.HasPinAsync())
        {
            Nav.NavigateTo("/setup", true); // Enforce initial lock setup
            return;
        }

        if (!AppState.IsUnlocked)
        {
            Nav.NavigateTo("/unlock", true); // Block access until unlocked
        }
    }
}
